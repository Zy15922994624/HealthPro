<view class="diet-container"><view class="stat-card"><view class="stat-header"><text class="title">今日摄入</text><text class="date">{{currentDate}}</text></view><view class="stat-content"><view class="stat-item"><text class="label">热量</text><view class="value-box"><text class="value">{{dailyNutrition.calories}}</text><text class="unit">千卡</text></view></view><view class="nutrition-bar"><view class="bar-item protein" style="{{'flex:'+(dailyNutrition.protein||0)+';'}}"><text>{{"蛋白质 "+dailyNutrition.protein+"g"}}</text></view><view class="bar-item fat" style="{{'flex:'+(dailyNutrition.fat||0)+';'}}"><text>{{"脂肪 "+dailyNutrition.fat+"g"}}</text></view><view class="bar-item carbs" style="{{'flex:'+(dailyNutrition.carbs||0)+';'}}"><text>{{"碳水 "+dailyNutrition.carbs+"g"}}</text></view></view></view></view><view class="meal-buttons"><block wx:for="{{$root.l0}}" wx:for-item="meal" wx:for-index="__i0__" wx:key="type"><view data-event-opts="{{[['tap',[['showAddForm',['$0'],[[['mealTypes','type',meal.$orig.type,'type']]]]]]]}}" class="meal-btn" bindtap="__e"><text class="meal-name">{{meal.$orig.name}}</text><text class="meal-status">{{meal.m0}}</text></view></block></view><view class="diet-list"><view class="list-header"><text class="title">今日记录</text></view><block wx:for="{{$root.l2}}" wx:for-item="meal" wx:for-index="__i1__" wx:key="type"><view class="meal-group"><view class="meal-header"><text class="meal-type">{{meal.m1}}</text><text class="meal-calories">{{meal.g0+"千卡"}}</text></view><block wx:for="{{meal.l1}}" wx:for-item="food" wx:for-index="__i2__" wx:key="id"><view class="food-item"><view class="food-info"><text class="food-name">{{food.$orig.foodName}}</text><text class="food-weight">{{food.$orig.foodWeight+"g"}}</text></view><view class="food-nutrition"><text class="calories">{{food.g1+"千卡"}}</text></view></view></block></view></block></view><uni-popup class="vue-ref" vue-id="2d036440-1" type="bottom" data-ref="addPopup" bind:__l="__l" vue-slots="{{['default']}}"><view class="add-form"><view class="form-header"><text class="title">{{$root.m2}}</text><text data-event-opts="{{[['tap',[['e0',['$event']]]]]}}" class="close" bindtap="__e">×</text></view><view class="search-box"><input class="search-input" type="text" placeholder="搜索食物" data-event-opts="{{[['input',[['__set_model',['','searchKey','$event',[]]],['onSearch',['$event']]]]]}}" value="{{searchKey}}" bindinput="__e"/></view><block wx:if="{{$root.g2}}"><scroll-view class="food-list" scroll-y="{{true}}"><block wx:for="{{filteredFoods}}" wx:for-item="food" wx:for-index="__i3__" wx:key="id"><view data-event-opts="{{[['tap',[['selectFood',['$0'],[[['filteredFoods','id',food.id]]]]]]]}}" class="food-item" bindtap="__e"><text class="name">{{food.name}}</text><text class="calories">{{food.calories+"千卡/100"+food.unit}}</text></view></block></scroll-view></block><block wx:else><block wx:if="{{searchKey}}"><view class="no-result"><text>未找到相关食物</text></view></block></block><block wx:if="{{selectedFood}}"><view class="selected-food"><view class="food-info"><text class="name">{{selectedFoodName}}</text><text class="unit">{{"每100"+selectedFood.unit}}</text></view><view class="nutrition-info"><text>{{"热量: "+selectedFood.calories+"千卡"}}</text><text>{{"蛋白质: "+selectedFood.protein+"g"}}</text><text>{{"脂肪: "+selectedFood.fat+"g"}}</text><text>{{"碳水: "+selectedFood.carbohydrate+"g"}}</text></view><view class="weight-input"><text class="label">食用重量(g)</text><input class="input" type="number" data-event-opts="{{[['input',[['__set_model',['$0','foodWeight','$event',[]],['formData']],['calculateNutrition',['$event']]]]]}}" value="{{formData.foodWeight}}" bindinput="__e"/></view><block wx:if="{{formData.foodWeight}}"><view class="calculated-nutrition"><text>实际摄入</text><text>{{"热量: "+$root.g3+"千卡"}}</text><text>{{"蛋白质: "+$root.g4+"g"}}</text><text>{{"脂肪: "+$root.g5+"g"}}</text><text>{{"碳水: "+$root.g6+"g"}}</text></view></block></view></block><button class="submit-btn" disabled="{{!isFormValid}}" data-event-opts="{{[['tap',[['e1',['$event']]]]]}}" bindtap="__e">确认添加</button></view></uni-popup></view>